## 目录结构

为了实现目录管理，操作系统中引入了文件控制块的数据结构

### 文件控制块(FCB)

- 用来**存放控制文件需要的各种信息**的数据结构，以实现"**按名存储**"

- FCB有序集合称为文件目录，**一个FCB**就是一个**文件目录项**

- **创建新文件**时，系统**分配一个FCB**并存放在文件目录中，成为**目录项**

#### FCB包含的信息

- 基本信息：文件名、物理位置、逻辑结构、物理结构

- 存取控制信息：文件存取权限

- 使用信息：建立时间、修改时间

### 索引结点

- 检索目录文件的过程中，只用到了文件名
</br>**仅当找到一个目录项**时，才需要从该目录项**读出文件物理地址**

- 文件描述信息单独形成**一个索引结点**的数据结构，称为i结点

- 文件目录中每个目录项仅由**文件名**和指向该文件所**对应的i结点的指针**构成

一个FCB的大小是64字节，盘块大小是1KB，在每个盘块中可以存放16个FCB

在**UNIX系统**中，一个目录项占16字节，其中**14字节**是**文件**名，**2字节**是**结点指针**

1KB盘块可存放64个目录项，查找文件时，**平均启动磁盘次数减少到原来的1/4**，大大节省了系统开销

![位示图法](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/UNIX-file-directory-structure.png)

UNIX文件目录结构

### 磁盘索引结点

- 文件主标识符，拥有该文件的个人或小组的标识符

- 文件类型

- 文件存取权限

- 文件物理地址，每个索引结点13个地址项，iaddr(0)~iaddr(2)
</br>它们以直接或间接方式给出数据文件所在盘块编号

- 文件长度，以字节为单位

- 文件链接计数，所有指向该文件的文件名的指针计数

- 文件存取时间，文件最近被进程存取、被修改的时间以及索引结点最近被修改的时间

- 文件被打开时，磁盘索引结点**复制到内存**的索引结点

##### 内存索引结点又增加了以下内容

- 索引结点编号，标识内存索引结点

- 状态，指示i结点是否上锁或被修改

- 访问计数，每当有一进程要访问此i结点，计数+1，访问结束-1

- 逻辑设备号，文件所属文件系统的逻辑设备号

- 链接指针，设置分别指向空闲链表和散列队列的指针

**FCB**或者是**索引结点**相当于图书馆中书本的**索书号**

### 目录结构

- 搜索：需要搜索目录，以找到该文件对应**目录项**(FCB)

- 创建文件：创建新文件时，需要增加一个**目录项**(FCB)

- 删除文件：删除一个文件时，需要在目录中删除一个**目录项**(FCB)

- 显示目录

- 修改目录：改变相应目录项

#### 单级目录结构

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Single-level-directory-structure.png)

**不能有重名文件**，实现了按名存取

#### 两级目录结构

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Double-level-directory-structure.png)

分为主文件目录(Master File Directory)和用户文件目录(user File Directory)

用户欲访问文件时，只需要**搜索**该用户对应的**UFD**即可

两级目录，**解决**了多用户间文件**重名问题**

#### 多级目录结构(树形目录结构)

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Tree-directory-structure.png)

**绝对路径**从**根目录**出发，**相对路径**，从**当前目录**出发，查找效率更高

树形目录结构便于文件分类，层次**结构清晰**，有效地进行文件管理和保护

查找一个文件时，需要按路径名**逐级访问**中间结点，**增加**了**磁盘访问**次数，影响查询速度

#### 无环图目录结构

![无环图目录结构](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/%E5%9B%BE%E5%BD%A2%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png "无环图目录结构")

树形目录结构不便于文件共享

增加了一些**指向同一结点**的有向边，引入无环图的目的是为了**实现文件共享**

为共享结点设置一个共享计数器，每当图中增加对该结点的共享链，计数器加1；

每当用户提出删除该结点，计数器减1，仅当计数器为0时，才真正删除该结点，否则仅删除共享链

### 共享文件与copy的区别

copy不是原件，原件被修改copy不会变

共享文件，**只存在一个**真正文件，**任何改变**都会为其他用户所见

