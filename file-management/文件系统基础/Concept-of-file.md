## 文件概念

### 文件定义

在系统运行时，计算机**以进程为基本单位**进行**资源的调度和分配**

在用户进行的输入、输出中，以**文件**为基本单位

#### 数据项

数据项是文件系统中**最低级**的数据组织形式

用于描述一个对象的某种属性的一个值

#### 记录

记录是一组相关数据项的集合，用于描述一个对象在某方面的属性

#### 文件

文件是由创建者所定义的一组相关信息的集合

逻辑上分为有结构文件和无结构文件两种

有结构文件，文件由一组**相似记录**组成，称为记录式文件

无结构文件看成是一个**字符流**，又称流式文件

### 文件属性

- 名称：文件名**唯一**

- 标识符：表示文件系统内文件**唯一标签**，数字

- 类型

- 位置：指向设备和设备上文件的**指针**

- 大小

- 保护：对文件进行保护的访问控制信息

- 时间、日期和用户标识：文件创建、上次修改和上次访问的相关信息

### 文件基本操作

- 创建文件：在文件系统中为文件找到空间；在目录中为新文件创建条目，该条目记录文件名称、位置及其他可能信息

- 写文件：执行一个**系统调用**，指明文件**名称**和写入文件的**内容**
</br>按照**文件名**搜索目录查找文件位置
</br>系统维护一个写位置的**指针**

- 读文件：执行一个**系统调用**，指明文件名称和要读入文件块的内存位置
</br>同样搜索目录以找到相关目录项
</br>系统维护一个读**指针**

- 文件重定位(文件寻址)：按条件搜索目录，将当前**文件位置设为给定值**，不会读、写文件

- 删除文件：先从目录中**找到要删除文件的目录项**，使之成为空项，**回收**所占存储空间

- 截断文件：允许文件所有**属性不变**，并删**除文件内容**，将其**长度设为0**并释放其空间

### 文件打开与关闭

首次使用文件，系统调用open，将文件的属性**从外存copy到内存**，并将该表目的**索引返回给用户**

系统维护一个打开文件信息表(open-file table)，可通过该表索引指定，**省略搜索环节**


#### 文件打开计数器(Open Count)

记录多少进程打开了该文件，每个关闭操作count--，当count=0，文件不再使用

此时，系统回收内存等资源，删除打开文件表中相应条目，最后释放文件的文件控制块(File Control Block)

每次打开文件都有

- 文件指针：系统跟踪上次读写位置作为当前文件位置指针，对进程来说**唯一**

- 文件打开计数：文件关闭时，os**复用**其打开文件表条目，当**计数为0**，系统**关闭文件**，**删除该条目**

- 文件磁盘位置：该信息保存在内存中，以免每个操作都从磁盘中读取

- 访问权限：rwx，该信息**保存在进程的打开文件表**中


