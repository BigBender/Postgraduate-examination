## 磁盘高速缓存

- 指利用内存空间暂存从磁盘中读出的盘块信息

- 是一组逻辑上属于磁盘，**物理上驻留内存的盘块**

### 磁盘高速缓存在内存中有两种形式

- 大小固定，不受应用程序多少的影响

- 所有未利用的内存空间作为一个缓冲池，供请求分页系统和磁盘I/O共享，因I/O的频繁程度而改变大小

### 数据交付方式

- 某进程访问磁盘数据，OS核心首**先查看磁盘高速缓存**，若有则拷贝

- **否则访问磁盘**，将所需数据交付请求进程，同时在高速缓存中复制一份，若以后需要可直接交付

#### 交付方式

- 将高速缓存中的数据直接传送到请求进程的内存区

- 交付给请求进程的是指向所需数据的指针

### 置换算法

- 类似于请求调页系统。将磁盘中的数据读入高速缓存时，若高速缓存中已装满数据，则需要置换

- 常用的置换算法：最近最久未用LRU、最近未使用NRU、最少使用算法

- 有的系统将高速缓存中的所有盘块拉成一条LRU链，会严重影响数据一致性的盘块和可能不再使用的盘块放在队首，使它们被优先写回

- 不久就要用到的盘块放在队尾

- LRU链意味着链中任一元素在被访问之后，会被放在队尾，而不被写回磁盘

### 设计高速缓存要考虑数据的一致性

- 系统发生故障，可能会造成内存高速缓存中的数据与磁盘数据不一致

#### 解决方案

- 备用电源

- OS定期回写机制：UNIX系统每隔30秒将高速缓存中所有“dirty”块、内存专用块、活动 i 结点都写回到外存原来位置

### 提高磁盘IO速度的其他方法

#### 提前读（Read-Ahead)

- 用户访问文件一般采用**顺序方式**

- 在将当前请求盘块读入磁盘高速缓存时，**可将下一个盘块的数据同时预先读入磁盘高速缓存**，从而减少磁盘I/O。

####  延迟写

- 缓冲区A本应立即写入磁盘，OS不马上写，而是将其**置于空闲缓冲区队尾**

- 若缓冲区A中数据在后期又被访问，可在此处找到，减少磁盘I/O

- **直到要用到该缓冲区，再将其写入磁盘**，腾出缓冲区

#### 优化物理块的分布

- 同一文件所占用的盘块应尽量安排在同一条磁道或相邻磁道上

- OS一般将同一条磁道上的若干个盘块组成一簇，**以簇为单位**给文件分配空间

#### 虚拟盘

- 利用**内存**空间去仿真磁盘，又称为RAM盘

- 该盘的设备驱动程序，可以接受所有标准的磁盘操作，但**操作在内存中进行，对用户透明**

- 虚拟盘的问题：**易失性**，通常用于存放临时文件，如目标文件等

- 虚拟盘与磁盘高速缓存的区别：**前者的内容由用户控制**，**后者由OS负责**，对用户是透明的


