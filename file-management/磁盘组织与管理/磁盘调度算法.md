## 磁盘调度

- 硬件解决

- 好的调度算法

- 缓冲区

- 来自不同进程的磁盘I/O请求构成一个随机分布的请求队列

- 磁盘I/O调度算法的主要目标就是减少**请求队列对应的平均柱面定位时间**（寻道时间）

## 一次磁盘读写操作的时间

### 寻道时间Ts

- 活动头磁盘在读写信息前，将磁头**移动到指定磁道所需要的时间**

- 这个时间除跨越n条磁道的时间外，还包括启动磁臂的时间s， Ts = m*n + s

- m是跨越一条磁道的时间，与磁盘驱动器速度有关，约为0.2ms，磁臂启动时间约为2ms

### 延迟时间Tr

- 磁头**定位**到某一磁道的扇区所需的时间

- 设磁盘的旋转速度为r，则 Tr = 1/2r

- 对于硬盘、典型的旋转速度为 5400r/m，相当于一周 11.1ms，Tr=1/2r=5.55ms

- 对于软盘，旋转速度在 300\~600r/m之间，则Tr为50~100ms

### 传输时间Tt

- 从磁盘读出或向磁盘写入数据所经历的时间，取决于每次读/写字节数b和磁盘旋转速度

- Tt = b/rN，r为磁盘每秒钟的转数，N为一个磁道上的字节数

- 延迟时间和传输时间斗鱼磁盘旋转速度相关，且为**线性相关**

### 总平均存取时间Ts

- Ta = Ts + Tr + Tr = Ts + 1/2r + b/rN

### 读写操作时间相关计算

- 磁盘有1000个柱面(0~999)，设磁头当前位置是756，请求序列 811， 348， 153， 968， 407， 500

- 磁头向大的方向移动，CSCAN算法完成请求的磁道序列，计算总磁道数

- 756->811->968->153->348->407->500，总的磁道数：1374

- 设某单位面磁盘转速为每分钟12000转，每个磁道有100个扇区，相邻磁道间的平均移动时间为1ms

- 且对请求队列中的每个磁道需读取1个随机分布的扇区，计算完成这些磁盘请求的寻道时间

#### 计算寻道时间

- 1374*1ms=1.374s

- 计算完成这些磁盘请求的访问时间

#### 计算延迟时间

- 12000r/min，每转一周所需时间为，60*1000/12000=1/200=5ms

- 平均旋转延迟(平均情况下，需要旋转半圈) 5/2=2.5ms 

- 总的旋转延迟时间，2.5*6=15ms

#### 计算传输时间

- 一共有100个扇区，读取每个扇区需要 0.05ms，总的传输时间 0.05*6=0.3ms

- 磁盘请求访问的(平均存取)总时间为：15.3+1374=1389ms

## 磁盘调度算法

### 先来先服务算法FCFS

- 根据进程请求访问磁盘的先后顺序进行调度

- 例如，磁盘请求队列中的请求顺序分别为 55、58、39、18、90、160、150、38、184

- 磁头初始位置是100磁道

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/FCFS.png)

磁头共移动了498个磁道，平均寻找长度=498/9=55.3

### 最短寻找时间优先

- 优先选择与当前磁头所在磁道距离最近的磁道调度处理，以使每次寻找时间最短

- 容易产生**饥饿**现象

- 例如，磁盘请求队列中的请求顺序分别为 55、58、39、18、90、160、150、38、184

- 磁头初始位置是100磁道

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/SSTF.png)

- 磁头共移动了248个磁道，平均寻找长度=248/9=27.5

### 扫描(SCAN)算法(电梯调度)(南理工默认SCAN是LOOK算法)

- SCAN算法在磁头当前移动方向上选择与当前磁头所在磁道距离最近的请求作为下一次服务的对象

- 例如，磁盘请求队列中的请求顺序分别为 55、58、39、18、90、160、150、38、184

- 磁头初始位置是100磁道，向磁道号增大的方向移动

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/SCAN.png)

- 磁头共移动了282个磁道，平均寻找长度=282/9=31.33

### 循环扫描(Circular SCAN, C-SCAN)算法

- 在SCAN基础上规定磁头单向移动来提供服务，回返时直接快速移动至起始段而不服务任何请求

- 例如，磁盘请求队列中的请求顺序分别为 55、58、39、18、90、160、150、38、184

- 磁头初始位置是100磁道，向磁道号增大的方向移动

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/C-SCAN.png)

#### N-Step-SCAN算法

- 把磁盘I/O请求队列分成长度为N的段，每次使用扫描算法处理这N个请求

- 将请求的任务分成长度为N的若干个队列，**队列间的调度采用FCFS方式**，队列**内部的请求以SCAN方式调度**

- 该算法的目标是**解决磁臂粘着**问题

- 当N值很大时，该算法接近于SCAN;而N=1时该算法变为FCFS

#### FSCAN调度算法

- 将N-Step-SCAN算法中的队列数目定为2

- 把磁盘I/O请求**分成两个队列**，交替使用扫描算法处理一个队列，新生成的磁盘I/O请求放入另一队列中

- 该算法的目标与N步扫描算法一致**解决磁臂粘着**问题

### LOOK和C-LOOK

在 SCAN 和 C-SCAN 基础上改进

磁头移动只需要**达到最远端的一个请求即可返回**，不需要到达磁盘端点

例如，磁盘请求队列中的请求顺序分别为 55、58、39、18、90、160、150、38、184

磁头初始位置是100磁道，向磁道号增大的方向移动

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/LOOK&C-LOOK.png)

### 磁盘调度算法比较

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Comparison-of-disk-scheduling-algorithms.png)

### 减少延迟时间提高磁盘传输效率

- 对盘面扇区进行交替编号

- 对磁盘组中的不同盘面错位命名

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Disk-slice-group-sector-number.png)

- 读取连续编号扇区的一种方法

- 假设每条磁道被分为8个扇区，每个扇区存放一个记录，处理程序顺序处理这8个记录L1，L2，...，L8

- 每次请求从磁盘上读一个记录，然后对读出的记录花1ms时间进行处理，以后再读下一个记录进行处理

- 磁盘旋转一周花费16ms。若将8个记录在一条磁道上进行优化分布，则全部处理完这8个记录至少需要多少ms

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Disk-sector-alternate-numbering.png)

#### 典型例题

- 需要**考虑磁头当前移动方向**的调度算法是 SCAN(电梯调度)，C-SCAN，LOOK，C-LOOK

- 磁盘调度策略中，有可能**使IO请求长期等待**的调度算法是 **最短寻道时间优先调度算法**
- 某时段外磁道请求不断，有可能内磁道请求长时间得不到服务

- 旋转延迟大小与磁盘调度算法无关
- 旋转延迟的大小取决于磁盘空闲空间的分配程序
- 旋转延迟的大小与文件的物理结构有关

- 磁盘调度算法中，可能出现**饥饿现象**的是，**最短寻找时间优先算**
- 当新的距离磁头比较近的磁盘访问请求，不断被满足，可能会导致比较远的磁盘访问请求被无限延迟，导致"饥饿现象"

- 已知某磁盘的平均转速为r秒/转，平均寻找时间为T秒，每个磁盘可以存储的字节数为N，现向该磁盘读写b字节的数据，采用随机寻道方法，每道的所有扇区组成一个簇，其平均访问时间是
- 每道的所有扇区组成一个簇，意味着将一个磁道的所有存储空间组织成一个数据块组，有利于提高存储速度
- 读写磁盘时，磁头首先找到磁道，称为寻道，然后可以将信息从磁道读出来或写进去，然后继续寻找下一个磁道，完成剩余的工作
- 读写一个磁道的时间包括寻道时间和读写磁道时间，T+r秒
- 总的数据量是b字节，它要占用的磁道数为 b/N 个，总的平均读写时间为 (T+r)b/N 秒

- 设磁盘的转速为3000r/min，盘面划分为10个扇区，读取一个扇区的时间为多少
- 访问每条磁道的时间 60/3000 = 20ms，即扇区旋转一周的时间，每个盘面10个扇区，读取一个扇区的时间为 20/10 = 2ms

- 一个磁盘的转速为7200r/min，盘面划分为160个扇区，每扇区有512B，理想情况下，数据传输速率是多少
- 磁盘的转速是 7200r/min=120r/s，转一圈经过160个扇区，每个扇区为512B，所以数据传输率为 120\*160\*512/1024KB/s=9600KB/s

- 设单面磁盘旋转速度为6000r/min，每个磁道有100个扇区，相邻磁道间平均移动时间为1ms，请求队列中有4个元素，每个磁道需读取1个随机分布的扇区，读完这4个扇区需要多少时间
- 旋转一周所需的时间 60*1000/6000 = 10ms 平均旋转延迟(平均情况下，需要旋转半圈): 10/2=5ms
- 总的旋转延迟，5*4=20ms
- 由前面知，旋转一周需要10ms，每个磁道有100个扇区，扫描每个扇区需要10/100=0.1ms
- 总的读取扇区的时间为 0.1*4=0.4ms
- 总的延迟时间+总的旋转时间 20+0.4=20.4ms，总的平均存取时间为寻道时间 + 20.4ms

- 假设磁盘每个磁道分成9个块，现有一文件有A，B，...，I共9个记录，每个记录的大小与块的大小相等，设磁盘转速为27ms/转，每读出一块后需要2ms的处理时间
- 如果顺序存放这些记录顺序读取，处理该文件要多少时间
- 由题知，磁盘转速27ms/r，每磁道存放9个记录，读出1个记录的时间是: 27/9=3ms
- 度数并处理记录A需要5ms，此时读写头已转到了记录B的中间，为了读出记录B，必须再转接近一圈(从B的中间到记录B末端)，后续8个记录的读取以及处理与此相同，第一个记录的读取与处理只需要5ms，8*(27 + 2 + 1)+(3 + 2) = 245ms
- 如果要顺序读取文件，记录如何存放处理时间最短，采用交替编号
- 从B开始往后，处理时间3(读出) + 2(处理) + 1(等待)=6ms
- 总的读取时间 6*8 + 5 = 53ms

- 某软盘有40个磁盘，磁头从一个磁道移至相邻磁道需要6ms，文件在磁盘上非连续存放
- 逻辑上相邻数据块的平均距离为13磁道，每块的旋转延迟和传输时间为100ms和25ms
- 问读取一个100块的文件需要多少时间
- 读一块数据的时间 13*6 + 100 + 25 = 203ms，读100块，20300ms
- 磁盘处理后，磁盘上相邻数据块距离有2磁道，读一块数据需要的时间 2*6 + 100 + 25=137ms
- 读取一个100块文件，137*100=13700ms

- 有一个交叉存放信息的磁盘，信息在其上存放方法
![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Alternate-numbering-instance.png)
- 每个磁道8个扇区，每个扇区512B，旋转速度为3000r/min，顺时针读扇区
- 假定磁头已经在读取信息的磁道上，0扇区转到磁头下需要1/2转，且设备对应的控制器不同同时进行输入/输出，在数据从控制器传送至内存的这段时间内，从磁头下通过的扇区数为2，问一次读出一个磁道的所有扇区需要多少时间? 数据传输速度为多少?
- 信息块的间隔是2个扇区，旋转一周需要的时间 60*1000/3000=20ms
- 读取一个扇区需要时间 20/8=2.5ms
- 读一个扇区并将扇区数据送入内存需要时间: 2.5*3=7.5ms
- 读出一个磁道上所有扇区需要时间: 20/2 + 8*7.5=70ms
- 每磁道数据量 8*512=4KB
- 数据传输速度为: 4KB/0.07s=57.1KB/S







