## 硬件保护

### 双运行模式

- 用户模式(执行普通用户应用程序)
</br>用户模式，目态

- 监控模式(Monitor mode)(执行操作系统核心代码)
</br>内核模式，系统模式，监控态，管态，特权模式

- 当中断或故障发生(自陷)，硬件自动从用户态切换到系统态

- 当用户程序需要操作系统的服务(通过系统调用)，它必须由目态切换到管态

双重模式确保系统和用户程序不受错误的用户程序的影响

#### 实现方法

将能引起损害的及其指令作为**特权指令**

特权指令只在系统态下运行

用户模式下试图执行特权指令，那么硬件认为该指令非法，并以陷阱的形式通知操作系统

由管态转换到目态是特权指令，其他的特权指令有IO控制，定时器管理和中断管理

### IO保护

- 所有的IO指令是特权指令

- 必须确保所用用户程序不能获得管态下操作系统所拥有的对系统的控制权

### 存储保护

- 某进程不可以访问其它进程的地址空间(非共享情况)

- 用户进程必须通过**系统调用**访问OS核心区

为了实现存储保护，在硬件上增加两个寄存器

- 基地址寄存器
</br>存放本进程**最低的内存物理地址**

- 界限寄存器
</br>存放本进程的**存储区域大小**

### 硬件保护原则

- 当操作系统在核心态下执行时，操作系统能够无限制地访问核心和所有用户进程的存储空间

- 修改基地址和界限地址寄存器内容的指令属于**特权指令**

### CPU保护

- 用户进程被派发CPU后，若程序是**死循环**，始终**不执行**系统调用， OS无法获得CPU控制权

### 系统必须避免上述情况发生

硬件设置**时钟**--**定时中断**，该中断使操作系统获得CPU控制权

- 定时是通过对每个**时钟脉冲**计数获得的，每来一个脉冲，预定的技术值减1

- 当计数值减到0，发生定时器中断

### 定时时钟是实现分时(time-sharing)操作系统的硬件基础

- 设定每N毫秒(时间片)时钟**中断一次**，即每个进程可使用处理器N毫秒
</br>无论完成与否都出让CPU，排队等待下个时间片

- 修改定时时钟的指令为**特权指令**