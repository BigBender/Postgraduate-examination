## 平衡二叉树

### 平衡二叉树的定义

- 为了避免树的高度增长过快，降低二叉排序树的性能

- 规定在插入和删除二叉树结点时，保证任意结点的左、右子树高度差绝对值不超过1，将这样的二叉树称为平衡二叉树

- 定义结点左子树与右子树的高度差为该结点的平衡因子，只可能是 -1, 0, 1

- 平衡二叉树可定义为它或者是一棵空树，或者具有下列性质：

- 它的左子树和右子树都是平衡二叉树，且左子树和右子树的高度差的绝对值不超过1

![image](https://github.com/YC-L/Postgraduate-examination/blob/DataStructure/imgs/Balanced-binary-tree.png)

#### 平衡二叉树的插入

- 每当在二叉排序树中插入(或删除)一个结点时，首先要检查其插入路径上的结点是否因为此次操作导致了不平衡

- 如果不平衡，先找插入路径上离插入结点最近的平衡因子绝对值大于1的结点A，以A为根子树，保持二叉排序树特性前提下，调整各结点的位置关系，使其重新到达平衡

![image](https://github.com/YC-L/Postgraduate-examination/blob/DataStructure/imgs/Balanced-binary-tree-demo.png)

#### LL平衡旋转(右单旋转)

- 由于在结点A的左孩子的左子树插入新结点，A的平衡因子从1增加到2，导致以A为根的子树失去平衡

- 需要一次向右的旋转操作

- 将A的左孩子B向右上旋转代替A成为根结点，将A结点向右下旋转成为B的右子树的根结点，B的原右子树作为原右子树作为A结点的左子树

![image](https://github.com/YC-L/Postgraduate-examination/blob/DataStructure/imgs/LL.png)

#### RR平衡旋转(左单旋转)

- 由于在结点A的右孩子的右子树插入新结点，A的平衡因子从-1减至-2，导致以A为根的子树失去平衡

- 需要一次向右的旋转操作

- 将A的右孩子B向左上旋转代替A成为根结点，将A结点向左下旋转成为B的左子树的根结点，B的原左子树作为原右子树作为A结点的右子树

![image](https://github.com/YC-L/Postgraduate-examination/blob/DataStructure/imgs/RR.png)

#### LR平衡旋转(先左后右双旋转)

- 由于在结点A的左孩子的右子树插入新结点，A的平衡因子从1增至2，导致以A为根的子树失去平衡

- 需要进行两次旋转操作，先左旋转后右旋转。

- 先将A结点的左孩子B的右子树的根结点C向左上旋转提升到B结点的位置，再把该C结点向右上旋转提到A结点的位置

![image](https://github.com/YC-L/Postgraduate-examination/blob/DataStructure/imgs/LR.png)

#### RL平衡旋转(先右后左双旋转)

- 由于在结点A的右孩子的左子树插入新结点，A的平衡因子从-1减至-2，导致以A为根的子树失去平衡

- 需要进行两次旋转操作，先右旋转后左旋转。

- 先将A结点的右孩子B的左子树的根结点C向右上旋转提升到B结点的位置，再把该C结点向左上旋转提到A结点的位置

![image](https://github.com/YC-L/Postgraduate-examination/blob/DataStructure/imgs/RL.png)

#### 注意，LR和RL旋转时，新结点插入在C的左子树还是右子树，不影响旋转过程

### 平衡二叉树的查找

- 平衡二叉树进行查找的过程和二叉排序树相同，查找过程中和给定值比较的关键字个数不超过树的深度

- 假设以Nh表示深度为h的平衡树中含有的最少结点数

- 含有n各结点的平衡二叉树的最大深度为O(log2 n)，平衡二叉树的平均查找长度为O(log2 n)

### 平衡二叉树（AVL）最小结点数与斐波那契数列的关系

- 平衡二叉树是什么

- 二叉树里面的完全二叉树就是一种很平衡的树，即按照1-23-4567-89101112131415-

- 这么一行行分叉下去的数

- 所以在二叉树的定义里，就有了这样的描述：

- 一个空树（根本没有结点的）；或者任意结点，它的左右子树的高度差不大于1

#### 只要满足任意一个结点的左右两子树的高度不大于1就可以是平衡二叉树

- 而刚才说的完全二叉树，是满足这一条件的"最完全"状态，所以自然也就存在去掉中间某些结点后还是平衡二叉树的"不完全"状态

#### 平衡因子

- 一个结点没有子树了，那么高度就是0（0 - 0 = 0），有一个子结点就为1（1 - 0 = 1）

- 这样再来理解左右子树的高度差

- 假设一棵树有3层，那么把第一层作为一个结点，第二第三层的结点构成这个结点的左右子树，这个3层数的高度也就是2（0、1、2），那么第一层结点的左右子树的高度也就为1，1或者0，1

用字母表示，这棵树的高度h，第一层结点的左右子树的高度，在结点数最少时，要满足一个是h - 1、另一个是h - 2；用nh来表示对应h的结点数，那么这里：n(h-1) = 1, n(h-2) = 0, n(h) = 1 + 0 + 1 = 2

- 推广出这个公式：n(h) = n(h-1) + n(h-2) + 1，这个1是两棵左右子树所上接的结点。
与斐波那契数列什么关系呢

- **斐波那契数列**的第1、第2项都为1，然后后面的每一项都是前两项之和

- **平衡二叉树的最小结点数**，第1项为1，第2项（h = 1）为2，且后面的每一项是前两项之和再加1

<table style="border-collapse: collapse;">
	<tr>
		<td>1</td>
		<td>1</td>
		<td>2</td>
		<td>3</td>
		<td>5</td>
		<td>8</td>
		<td>13</td>
		<td>21</td>
		<td>34</td>
	</tr>
	<tr>
		<td>1</td>
		<td>2</td>
		<td>4</td>
		<td>7</td>
		<td>12</td>
		<td>20</td>
		<td>33</td>
		<td></td>
		<td></td>
	</tr>
</table>

- 可以观察到nh = F(h+2) - 1

### 典型例题

若平衡二叉树的高度为6，且所有非叶结点的平衡因子均为 1，则该平衡二叉树的结点总数 

A.12

B.20

C.32

D.33

- 最小平衡二叉树结点的公式 F(n)=F(n-1)+F(n-2)+1

- Fibonacci(斐波那契)数列，1是根节点，F(n-1)是左子树的节点数量，F(n-2)是右子树的节点数量
</br>注意：F(0) = 0，F(1) = 1，F(2) = F(0) + F(1)

- 得知平衡二叉树的最少的结点的个数为15

- 而对于二叉树的最多的结点的个数是i2^h-1=31，因而用排除法，得知是20