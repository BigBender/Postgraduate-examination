## 设备分配与回收

### 设备分配概述

- 设备分配是指根据用户的IO请求分配所需的设备

- 分配总原则，充分发挥设备的使用效率
</br>尽可能地让设备忙碌，又避免不合理分配造成进程死锁

- 独占式设备
</br>申请设备时，如果设备空闲，就将其独占，不再允许其他进程申请使用，一直等到该设备被释放才允许其他进程申请使用

- 分时式共享使用设备
</br>分时共享，提高利用率

- 以SPOOLing方式使用的外部设备(Simultaneous Peripheral Operation On-Line)
</br>假脱机，实质上是对I/O的批处理操作，**空间换时间**
</br>页面调度算法正好相反，是以**时间换空间**的技术

### 设备分配的数据结构

#### 设备控制表 DCT

![设备控制表](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/%E8%AE%BE%E5%A4%87%E6%8E%A7%E5%88%B6%E8%A1%A8.png "设备控制表")

- 一个设备控制表就表征一个设备，而则会个控制表中的**表项**就是设备的**各个属性**

- 每个设备控制表，都需要一个**指向控制器控制表**的一**指针**，因此DCT与COCT**一对一关系**

#### 控制器控制表 COCT

![设备控制表](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Controller-control-table.png "设备控制表")

- 设备控制器控制设备与内存交换数据，而设备控制器又需要请求通道为它服务

- 每个COCT必定有一个表项存放指向**相应通道控制表**(CHCT)的指针

- **一个**通道可以为**多个**设备控制器服务

- CHCT必定有一个指针指向一个表，这个表表达的是CHCT提供服务的那几个设备控制器

- **CHCT与COCT**的关系是**一对多**的关系

#### 通道控制表 CHCT

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/CHCT.png)

- 一个通道可以为多个设备控制器服务

- CHCT中必定有一个指针指向一个表，该表记录CHCT提供服务的那交给设备控制器

- CHCT与COCT一对多关系

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/DCT-COCT-CHCT.png)

DCT、COCT和CHCT之间的关系

#### 系统设备表 SDT

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/SDT.png)

- 整个系统只有一张SDT

- 记录已连接系统中的所有物理设备的情况

- 每个物理设备占一个表目

#### 在多道程序系统中，进程数多于资源数，引起资源竞争

- IO设备固有属性

- IO设备的分配算法

- IO设备分配的安全性

- IO设备的独立性

### 设备分配策略

- 设备分配原则，根据设备特性、用户要求和系统配置情况
</br>充分**发挥**设备使用**效率**，**避免**造成进程**死锁**，**隔离**用户**程序**与**设备**

- 设备分配方式：静态和动态
</br>**静态分配**，主要用于**独占设备**的分配，不会出现死锁，但是使用**效率低**
</br>**动态分配**，在进程执行过程中按需分配，利于**提高**设备**利用率**
</br>但分配算法使用不当，**可能**造成进程**死锁**

- 设备分配算法，先请求先分配，优先级高者优先等

### 设备分配安全性

#### 设备分配中应防止发生进程死锁

- 安全分配方式，每当进程发出I/O请求后进入**阻塞状态**，直到I/O操作完成才唤醒
</br>优点：设备分配安全；缺点：CPU和IO设备串行工作

- 不安全分配方式，进程在发出I/O请求后**继续运行**，同时发出第二个、第三个I/O请求
</br>仅当进程**所请求设备被另一进程占用时**，才**进入阻塞**状态
</br>优点：一个进程**可同时操作多个设备**，使进程推进迅速；缺点：可能产生死锁

### 逻辑设备名到物理设备名

- 为了实现设备独立性，系统中设置一张逻辑设备表(Logical Unit Table，LUT)

- 将逻辑设备名映射为物理设备名

- LUT包括逻辑设备名、物理设备名和设备驱动程序入口地址

#### 两种方式建立逻辑设备表

- 只设置一张LUT，适用于单用户系统

- 为每个用户设置一张LUT，用户登陆时，为用户建立一个进程，同时建立一张LUT，并将表放入进程的PCB中














