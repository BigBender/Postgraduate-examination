## 高速缓存与缓冲区

### 磁盘高速缓存(Disk Cache)

- 操作系统使用磁盘高速缓存技术**提高磁盘的I/O速度**
</br>对**高速缓存复制**的访问要比原始数据访问更为**高效**

- 磁盘高速缓存技术**不同于**通常意义下的介于CPU与内存之间的小容量高速存储器
</br>**利用内存中的存储空间**暂存从磁盘中读出的一系列**盘块中的信息**

- 磁盘高速缓存技术，在**逻辑上**属于**磁盘**，**物理**上是驻留在**内存**中的盘块

#### 高速缓存在内存中分为两种形式

- 一种是在**内存**总开辟一个单独的存储空间作为磁盘高速缓存，**大小固定**

- 另一种是把**未利用的内存**空间作为一个缓冲池，供请求分页系统和磁盘IO时**共享**

### 缓冲区

- **缓和**CPU和I/O设备间速度**不匹配**的矛盾

- **减少**对CPU的中断频率，**放宽**对CPU中断响应时间的限制

- **解决**基本数据单元大小**不匹配**的问题

- **提高**CPU和I/O设备之间的**并行性**

#### 实现方法

- 采用硬件缓冲器，成本高，除关键部位都不用

- 采用缓冲区(位于内存区域)，缓冲区数据非空时，不能往缓冲区冲入数据
</br>当缓冲区为空时，可以**往缓冲区冲入数据**，但必须把缓冲区**充满以后**才能传出数据

### 单缓冲

- 在设备和处理机之间设置一个缓冲区

- 设备和处理机交换数据时，先把被交换数据写入缓冲区，然后需要数据的设备或处理机从缓冲区取走数据

![单缓冲](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/%E5%8D%95%E7%BC%93%E5%86%B2.png "单缓冲")

### 研究缓冲计数时，假设一种初时状态，计算下一次到达相同状态时所需要的时间

初始状态为，工作区是满的，缓冲区是空的

- 假定磁盘把一块数据输入到缓冲区的时间为T

- 操作系统将该缓冲区数据传送到用户区时间为M

- CPU对这一块数据处理的时间为C

假设T>C，整个过程用时 M+T

若T<C，整个过程用时 M+C

![使用时间对比](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/%E5%8D%95%E7%BC%93%E5%86%B2%E4%BD%BF%E7%94%A8%E6%97%B6%E9%97%B4%E5%AF%B9%E6%AF%94.png "使用时间对比")

### 双缓冲

- I/O设备输入数据时先装填到缓冲区1，在缓冲区1满后再装填到缓冲区2

- 与此同时，处理机可以从缓冲区1取出数据放入用户进程，**若缓冲区2已填满**
</br>处理机可以从缓冲区2取出数据处理，I/O设备又可以装填缓冲区1

![双缓冲](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Double-buffer.png)

### 初始状态，假设一个缓冲区是空的，另一个缓冲区是满的

假设T<C+M，整个过程用时C+M

若T>C+M，整个过程用时T

若M+C<T，可使设备连续输入，CPU不必等待

![双机通信缓冲区](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/%E5%8F%8C%E6%9C%BA%E9%80%9A%E4%BF%A1%E7%BC%93%E5%86%B2%E5%8C%BA.png "双机通信缓冲区")

#### 单缓冲和双缓冲的相关计算

某文件占10个磁盘块，现要把该文件磁盘块逐个读入主存缓冲区，并送用户区进行分析，假设一个缓冲区与一个

磁盘块大小相同，把一个磁盘块读入缓冲区的时间为 100us，将缓冲区的数据传送到用户区的时间是50us

CPU对一块数据进行分析的时间为50us。在单缓冲区和双缓冲区结构下，读入并分析完该文件的时间是

- 单缓冲区
</br>第一个块输入到缓冲区，100us，传送到用户区50us，CPU处理50us
</br>从第二个块开始，是从第一个块将数据传送到用户区后开始填入缓冲区，同时CPU取当前用户进程的数据处理(第一个块的数据)
</br>缓冲区传送数据到用户区50us，取这一次的数据处理CPU花费50us，处理的同时等待缓冲区数据填满
</br>CPU每次处理上一个块，花费时间 100+50 = 150us
</br>总时间，150*10 + 50(第一个块缓冲区多出的50us)=1550

- 双缓冲区
</br>前两个块输入到缓冲区，100us，此后，CPU处理数据不需要等待缓冲区
</br> 100*10 + 100(首次放入数据到缓冲区)=1100

### 循环缓冲

- 包含多个**大小相等**的缓冲区

- 每个缓冲区中有一个链接指针**指向下一个**缓冲区，最后一个缓冲区指针**指向第一个**缓冲区

### 缓冲池

由多个系统公用的缓冲区组成，按其使用状况形成三个队列

- 空缓冲队列

- 装满**输入数据**缓冲区队列

- 装满**输出数据**缓冲区队列

![缓冲区](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/%E7%BC%93%E5%86%B2%E5%8C%BA.png "缓冲区")

### 高速缓存与缓冲区对比

- 高速缓存是可以**保存数据拷贝**的高速存储器

- 访问高速缓存比访问原始数据更高效，速度更快

![高速缓存与缓冲区对比](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/difference-between-cache&buffer.png)











