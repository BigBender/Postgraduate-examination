## 内存管理概念

- 操作系统对内存的**划分**和**动态分配**，就是内存管理的概念

- 有效的内存管理在多道程序设计中非常重要，不仅方便用户使用存储器，提高内存利用率，还可以通过虚拟级数从逻辑上扩充存储器

### 内存管理的功能

- 内存空间分配与回收，由os完成存储器空间的分配和管理，使程序员摆脱存储分配的麻烦，提高效率

- 地址转换：在多道程序环境下，程序中的逻辑地址与内存中的物理地址不可能一致，存储管理必须提供地址变换功能，将逻辑地址转换成相应的物理地址

- 内存空间的扩充: 利用虚拟存储技术或自动覆盖技术，从逻辑上扩充内存

- 存储保护: 保证各道作业在各自的存储空间内运行，互不干扰

### 进程运行的基本原理

- 首先将程序和数据装入内存，将用户源程序变为可在内存中执行的程序

#### 程序装入和链接

- 编译: 由**编译程序**将用户源代码**编译**成若干个**目标模块**

- 链接: 由**链接程序**将编译后的一组**目标模块**，以及**所需库函数链接在一起**，形成一个完整的**装入模块**

- 装入: 由**装入程序**将装入模块**装入内存**运行

#### 程序链接有三种方式

- **静态链接**，运行前，将各目标模块及它们所需的库函数，链接成一个完整的可执行程序，**以后不再拆开**

- **装入时动态链接**，编译后得到目标模块，装入内存时，**边装入边链接**

- **运行时动态链接**，**需要**该目标模块时，**才**对它进行链接，优点是**便于修改和更新**，便于实现对目标模块的**共享**

#### 装入有三种方式

##### 绝对装入

- **绝对装入**，如果知道程序将在**内存中的驻留位置**，编译程序将产生绝对地址的目标代码

- 绝对装入程序按照**装入模块中的地址**，将程序和数据的地址进行修改，将程序和数据装入内存，

- 程序中逻辑地址与实际内存地址完全相同，**不需要地址转换**

- 绝对装入只适合**单道程序环境**，程序中所使用的绝对地址，可在编译和汇编时给出，也能由程序员直接赋予

- 通常情况下在程序中采用**符号地址**，编译或汇编时再转换为绝对地址

- 动态运行时装入，**推迟到程序执行**时进行地址转换，可分配程序到不连续的存储区

##### 可重定位装入

- **可重定位装入**，在多道程序环境下，多个目标模块的其实地址通常都是从0开始

- 程序中其他地址都是相对于起始地址的，应采用可重定位装入方式

- 根据内存的情况，将装入模块装入到内存的适当位置

- 装入时，对目标程序中指令和数据的修改过程称为**重定位**

- 地址变换通常是在装入时一次完成的，又称为**静态重定位**

- 静态重定位的特点是在一个作业装入内存时，**必须分配其要求的全部内存空间**，如果没有足够的内存，不能装入该作业，作业一旦进入内存后，**在整个运行期间不能在内存中移动**，不能再申请内存空间

##### 动态运行时装入

- 又称**动态重定位**，程序在内存中如果发生移动，就需要采用动态的装入方式

- 装入程序在把装入模块装入内存后，不立即把装入模块中的**相对地址**转换为绝对地址，而是把这种地址转换**推迟到程序真正要执行时**才进行 

- 装入内存后的所有地址均为**相对地址**，需要一个**重定位寄存器**的支持

- 动态重定位的特点是可以将程序分配到**不连续**的存储区

- 在程序运行之前可以只装入它的部分代码即可投入运行，然后在程序运行期间，根据需要**动态申请分配内存**

- 便于**程序段的共享**，可以向用户提供一个比存储空间大得多得地址空间

### 内存保护

- 内存分配前，保护操作系统不受用户进程影响

- CPU中设置**一对上、下限**寄存器，存放用户作业在主**存下限和上限地址**

- 每当CPU要访问一个地址时，分别和两个寄存器的值相比，**判断有无越界**

- 重定位寄存器(**基址**寄存器)，含有**最小的物理地址**值

- 界地址寄存器(**限长**寄存器)，含有**最大的逻辑地址**值

- 每个逻辑地址值必须**小于**界地址寄存器

- 内存管理机构动态地将逻辑地址与界地址寄存器比较，如果未发生地址越界，则加上重定位寄存器地值后映射成物理地址，再送交内存单元

![image](https://github.com/YC-L/Postgraduate-examination/blob/Operating-System/imgs/Relocation&boundary-address-register.png)

- 当CPU调度程序选择进程执行时，派遣程序会初始化重定位寄存器和界地址寄存器

- 每个逻辑地址都需要与这两个寄存器进行核对，保证操作系统和其他用户程序及数据不被该进程运行影响

- 重定位寄存器是用来 "加" 的，逻辑地址加上重定位寄存器中的值能得到物理地址

- 界地址寄存器是用来 "比" 的，通过比较界地址寄存器中的值与重定位寄存器加上逻辑地址的值来判断是否越界

### 典型例题

- 动态重定位是在作业的 **执行过程** 中执行

- **绝对装入**是在作业**编译过程**中进行，**静态重定位**是在**作业装入**过程中进行，**动态重定位**是在**作业执行**时进行












